<!DOCTYPE html>
<html lang="en" class="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Chat App</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white">

  <!-- Top navbar -->
  <div class="flex justify-between items-center p-4 border-b dark:border-gray-700">
    <div class="text-lg font-bold">Aris</div>
    <div class="flex items-center gap-3">
      <button id="archive-btn" type="button" title="Archive">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M20 7v10a2 2 0 01-2 2H6a2 2 0 01-2-2V7m16 0V5a2 2 0 00-2-2H6a2 2 0 00-2 2v2m16 0H4" />
        </svg>
      </button>
      <button id="share-btn" type="button" title="Share">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 12v.01M8 12v.01M12 12v.01M16 12v.01M20 12v.01" />
        </svg>
      </button>
      <button id="more-btn" type="button" title="More">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <circle cx="5" cy="12" r="1.5" />
          <circle cx="12" cy="12" r="1.5" />
          <circle cx="19" cy="12" r="1.5" />
        </svg>
      </button>
      <button id="login-btn" type="button" title="Login">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M5.121 17.804A13.937 13.937 0 0112 15c2.5 0 4.847.652 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z" />
        </svg>
      </button>
      <button id="theme-toggle" type="button" title="Toggle Theme">
        <svg id="theme-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"></svg>
      </button>
    </div>
  </div>

  <!-- Chat area -->
  <div class="p-4 space-y-4" id="chat-container">
    <div id="messages" class="space-y-2"></div>
    <form id="message-form" class="flex gap-2">
      <input id="user-input" class="flex-1 border rounded px-3 py-2 dark:bg-gray-800 dark:border-gray-600"
        placeholder="Ask me anything..." />
      <button type="submit" class="bg-blue-500 text-white px-3 py-2 rounded">Send</button>
    </form>
  </div>

  <!-- Login Modal -->
  <div id="login-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white dark:bg-gray-800 p-6 rounded space-y-4">
      <h2 class="text-lg font-bold">Login</h2>
      <input type="text" placeholder="Username" class="w-full border rounded px-3 py-2 dark:bg-gray-700" />
      <input type="password" placeholder="Password" class="w-full border rounded px-3 py-2 dark:bg-gray-700" />
      <div class="flex justify-end gap-2">
        <button id="login-cancel" type="button" class="px-3 py-1 border rounded">Cancel</button>
        <button id="login-submit" type="button" class="px-3 py-1 bg-blue-500 text-white rounded">Login</button>
      </div>
    </div>
  </div>

  <script>
    const themeIcon = document.getElementById('theme-icon');
    const html = document.documentElement;

    function setThemeIcon(isDark) {
      themeIcon.innerHTML = '';
      themeIcon.setAttribute('stroke-width', '2');
      themeIcon.setAttribute('stroke-linecap', 'round');
      themeIcon.setAttribute('stroke-linejoin', 'round');
      if (isDark) {
        themeIcon.innerHTML = '<path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>';
      } else {
        themeIcon.innerHTML = '<path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>';
      }
    }

    if (localStorage.getItem('theme') === 'dark') {
      html.classList.add('dark');
      setThemeIcon(true);
    } else {
      setThemeIcon(false);
    }

    document.getElementById('theme-toggle').addEventListener('click', () => {
      const isDark = !html.classList.contains('dark');
      html.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      setThemeIcon(isDark);
    });

    document.getElementById('login-btn').addEventListener('click', () => {
      document.getElementById('login-modal').classList.remove('hidden');
    });

    document.getElementById('login-cancel').addEventListener('click', () => {
      document.getElementById('login-modal').classList.add('hidden');
    });

    document.getElementById('login-submit').addEventListener('click', () => {
      alert('Login successful!');
      document.getElementById('login-modal').classList.add('hidden');
    });

    document.getElementById('archive-btn').addEventListener('click', () => {
      alert('Archive clicked!');
    });

    document.getElementById('share-btn').addEventListener('click', () => {
      alert('Share clicked!');
    });

    document.getElementById('more-btn').addEventListener('click', () => {
      alert('More options clicked!');
    });

// WebSocket logic
let socket;

function connectSocket() {
  socket = new WebSocket("ws://localhost:8080");

  socket.onopen = () => {
    console.log("✅ WebSocket connected");
  };

  socket.onmessage = (event) => {
    console.log("📥", event.data);
    addMessage(event.data, false);
  };

  socket.onclose = () => {
    console.log("❌ WebSocket closed. Reconnecting...");
    setTimeout(connectSocket, 1000);
  };

  socket.onerror = (err) => {
    console.error("⚠ WebSocket error:", err);
  };
}

connectSocket();

function safeSend(message) {
  if (socket && socket.readyState === WebSocket.OPEN) {
    socket.send(message);
  } else {
    console.log("⚠️ WebSocket not open. Message not sent:", message);
  }
}

document.getElementById('message-form').addEventListener('submit', e => {
  e.preventDefault();
  const input = document.getElementById('user-input');
  const msg = input.value.trim();
  if (!msg) return;
  addMessage(msg, true);
  safeSend(msg);
  input.value = '';
});

    function addMessage(content, isUser) {
      const div = document.createElement('div');
      div.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
      div.innerHTML = `
        <div class="${isUser ? 'bg-blue-500 text-white' : 'bg-purple-100 dark:bg-purple-900/50 text-gray-800 dark:text-white'} p-2 rounded-lg max-w-xs">
          ${content}
        </div>`;
      document.getElementById('messages').appendChild(div);
      document.getElementById('chat-container').scrollTop = document.getElementById('chat-container').scrollHeight;
    }
    
  </script>

</body>
</html>
